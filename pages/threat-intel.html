<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Threat Intelligence Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg1: #0f172a;
      --bg2: #0b1220;
      --panel: #1e293b;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #60a5fa;
      --accent2: #22d3ee;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 240px;
      background: var(--panel);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      border-right: 1px solid rgba(255,255,255,0.1);
      align-items: center;
    }
    .logo-link {
      display: block;
      margin-bottom: 1.5rem;
    }
    .logo {
      width: 60px;
      height: auto;
    }
    .sidebar h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      text-align: center;
      color: var(--accent2);
    }
    .sidebar a.menu-link {
      width: 100%;
      color: var(--text);
      text-decoration: none;
      padding: 0.6rem 0.8rem;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      display: block;
      transition: background 0.2s;
      text-align: center;
    }
    .sidebar a.menu-link:hover,
    .sidebar a.menu-link.active {
      background: rgba(96,165,250,0.2);
    }
    .main {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 1.5rem;
    }
    .feed-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .feed-table th,
    .feed-table td {
      border: 1px solid rgba(255,255,255,0.1);
      padding: 0.75rem;
      text-align: left;
    }
    .feed-table th {
      background: var(--panel);
      color: var(--accent);
      width: 200px;
    }
    .feed-card {
      background: var(--panel);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .feed-card h3 {
      margin-bottom: 0.5rem;
      color: var(--accent2);
    }
    .content-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <!-- Logo -->
    <a href="/index.html" class="logo-link">
      <img src="/images/TIS_Logo.png" alt="Threat Intel Specialist Logo" class="logo">
    </a>

    <h2>Threat Feeds</h2>
    <a href="#" id="link-cisa" class="menu-link active" onclick="showFeed('cisa')">CISA Advisories</a>
    <a href="#" id="link-ncsc" class="menu-link" onclick="showFeed('ncsc')">UK NCSC</a>
    <a href="#" id="link-vt" class="menu-link" onclick="showFeed('virustotal')">VirusTotal</a>
  </aside>

  <main class="main">
    <div id="feed-container">
      <p>Select a feed from the left menu to begin.</p>
    </div>
  </main>

  <script>
    const links = {
      cisa: document.getElementById('link-cisa'),
      ncsc: document.getElementById('link-ncsc'),
      virustotal: document.getElementById('link-vt')
    };

    function setActive(feed) {
      Object.values(links).forEach(el => el.classList.remove('active'));
      links[feed].classList.add('active');
    }

    async function showFeed(feed) {
      setActive(feed);
      const container = document.getElementById('feed-container');
      container.innerHTML = `<p>Loading ${feed.toUpperCase()} feed...</p>`;

      if (feed === 'cisa') {
        try {
          const res = await fetch('/feeds/cisa/advisories.json');
          if (!res.ok) throw new Error('Failed to fetch feed');
          const data = await res.json();
          renderCisa(data, container);
        } catch (e) {
          container.innerHTML = `<p>Error loading CISA feed.</p>`;
        }
      } else {
        container.innerHTML = `<p>${feed.toUpperCase()} feed coming soon!</p>`;
      }
    }

    function renderCisa(data, container) {
      container.innerHTML = '<div class="content-title">CISA Cybersecurity Advisories</div>';
      data.items.forEach(item => {
        container.innerHTML += `
          <div class="feed-card">
            <h3>${item.title || 'No Title'}</h3>
            <table class="feed-table">
              <tr><th>Vendor</th><td>${item.vendor || 'N/A'}</td></tr>
              <tr><th>Affected Products</th><td>${item.affected_products || 'N/A'}</td></tr>
              <tr><th>Release Date</th><td>${item.release_date || item.published || 'N/A'}</td></tr>
              <tr><th>CVSS v4</th><td>${item.cvss_v4 || 'N/A'}</td></tr>
              <tr><th>Summary</th><td>${item.executive_summary || item.summary || 'N/A'}</td></tr>
              <tr><th>Risk</th><td>${item.risk_evaluation || 'N/A'}</td></tr>
              <tr><th>Overview</th><td>${item.vulnerability_overview || 'N/A'}</td></tr>
              <tr><th>Mitigations</th><td>${item.mitigations || 'N/A'}</td></tr>
            </table>
          </div>`;
      });
    }

    // Load CISA by default
    window.addEventListener('DOMContentLoaded', () => showFeed('cisa'));
  </script>
</body>
</html>
